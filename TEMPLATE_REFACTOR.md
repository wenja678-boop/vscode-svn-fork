# WebView æ¨¡æ¿é‡æ„æ–¹æ¡ˆ

## ğŸš¨ å½“å‰é—®é¢˜

åœ¨ `folderCommitPanel.ts` æ–‡ä»¶ä¸­ï¼Œ`_getHtmlForWebview()` æ–¹æ³•å­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š

1. **ä»£ç æ··åˆ**ï¼š600+ è¡Œçš„ HTML/CSS/JavaScript ä»£ç ç›´æ¥åµŒå…¥åœ¨ TypeScript æ–‡ä»¶ä¸­
2. **å¯ç»´æŠ¤æ€§å·®**ï¼šHTML æ¨¡æ¿ä¿®æ”¹å›°éš¾ï¼Œæ²¡æœ‰è¯­æ³•é«˜äº®å’Œæ™ºèƒ½æç¤º
3. **å¯è¯»æ€§å·®**ï¼šä¸šåŠ¡é€»è¾‘å’Œè§†å›¾æ¨¡æ¿æ··åœ¨ä¸€èµ·
4. **é‡å¤ä»£ç **ï¼šç±»ä¼¼çš„ WebView æ¨¡æ¿åœ¨å¤šä¸ªæ–‡ä»¶ä¸­é‡å¤

## ğŸ’¡ è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆä¸€ï¼šæ¨¡æ¿æ–‡ä»¶åˆ†ç¦»ï¼ˆå·²å®ç°ï¼‰

å°† HTMLã€CSSã€JavaScript åˆ†ç¦»åˆ°ç‹¬ç«‹æ–‡ä»¶ï¼š

```
src/templates/
â”œâ”€â”€ folderCommitPanel.html    # HTML ç»“æ„
â”œâ”€â”€ folderCommitPanel.css     # æ ·å¼æ–‡ä»¶
â”œâ”€â”€ folderCommitPanel.js      # è„šæœ¬é€»è¾‘
â””â”€â”€ templateManager.ts        # æ¨¡æ¿ç®¡ç†å™¨
```

#### æ ¸å¿ƒæ”¹è¿›ï¼š

1. **æ¨¡æ¿ç®¡ç†å™¨** (`TemplateManager`)
   - ç»Ÿä¸€ç®¡ç†æ‰€æœ‰ WebView æ¨¡æ¿
   - æ”¯æŒæ¨¡æ¿å˜é‡æ›¿æ¢
   - æä¾›å†…è”å’Œå¤–éƒ¨èµ„æºä¸¤ç§åŠ è½½æ–¹å¼
   - å®Œå–„çš„é”™è¯¯å¤„ç†å’Œå¤‡ç”¨æ–¹æ¡ˆ

2. **æ–‡ä»¶åˆ†ç¦»**
   - HTMLï¼šçº¯ç»“æ„ï¼Œä½¿ç”¨ `{{å˜é‡å}}` å ä½ç¬¦
   - CSSï¼šç‹¬ç«‹æ ·å¼æ–‡ä»¶ï¼Œæ”¯æŒ VSCode ä¸»é¢˜å˜é‡
   - JavaScriptï¼šç‹¬ç«‹è„šæœ¬é€»è¾‘ï¼Œä¿æŒåŸæœ‰åŠŸèƒ½

3. **ç±»å‹å®‰å…¨**
   - TypeScript æ¥å£å®šä¹‰æ¨¡æ¿å˜é‡
   - ç¼–è¯‘æ—¶æ£€æŸ¥æ¨¡æ¿å‚æ•°
   - å¼‚æ­¥åŠ è½½å¤„ç†

#### ä½¿ç”¨ç¤ºä¾‹ï¼š

```typescript
// æ—§æ–¹å¼ï¼ˆé—®é¢˜ä»£ç ï¼‰
private _getHtmlForWebview(): string {
    return `<!DOCTYPE html>...600+ è¡Œæ··åˆä»£ç ...`;
}

// æ–°æ–¹å¼ï¼ˆé‡æ„åï¼‰
private async _getHtmlForWebview(): Promise<string> {
    const templateVariables = {
        FILTER_INFO: this._renderFilterInfo(),
        FILE_LIST: this._renderFileList(this._fileStatuses),
        PREFIX_OPTIONS: this._renderPrefixOptions(),
        LATEST_PREFIX: this.logStorage.getLatestPrefix()
    };
    
    return await this.templateManager.loadInlineTemplate(
        'folderCommitPanel', 
        templateVariables
    );
}
```

### æ–¹æ¡ˆäºŒï¼šç»„ä»¶åŒ–æ¶æ„ï¼ˆæ¨èè¿›ä¸€æ­¥ä¼˜åŒ–ï¼‰

```
src/webview/
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ FileList.ts           # æ–‡ä»¶åˆ—è¡¨ç»„ä»¶
â”‚   â”œâ”€â”€ FilterSection.ts      # è¿‡æ»¤å™¨ç»„ä»¶
â”‚   â””â”€â”€ CommitSection.ts      # æäº¤åŒºåŸŸç»„ä»¶
â”œâ”€â”€ templates/
â”‚   â””â”€â”€ ...                   # æ¨¡æ¿æ–‡ä»¶
â””â”€â”€ WebViewManager.ts         # WebView ç®¡ç†å™¨
```

### æ–¹æ¡ˆä¸‰ï¼šç°ä»£å‰ç«¯æ¡†æ¶é›†æˆ

ä½¿ç”¨ React/Vue ç­‰æ¡†æ¶æ„å»º WebViewï¼š

```
src/webview/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/           # React/Vue ç»„ä»¶
â”‚   â”œâ”€â”€ hooks/               # è‡ªå®šä¹‰ hooks
â”‚   â””â”€â”€ utils/               # å·¥å…·å‡½æ•°
â”œâ”€â”€ dist/                    # æ„å»ºè¾“å‡º
â””â”€â”€ webpack.config.js        # æ„å»ºé…ç½®
```

## ğŸ¯ æ¨èå®æ–½æ­¥éª¤

### ç¬¬ä¸€é˜¶æ®µï¼šæ¨¡æ¿åˆ†ç¦»ï¼ˆå·²å®Œæˆï¼‰
- âœ… åˆ›å»º `TemplateManager` ç±»
- âœ… åˆ†ç¦» HTML/CSS/JavaScript æ–‡ä»¶
- âœ… é‡æ„ `folderCommitPanel.ts`

### ç¬¬äºŒé˜¶æ®µï¼šæ‰©å±•åˆ°å…¶ä»–é¢æ¿
- ğŸ”„ é‡æ„ `svnLogPanel.ts`
- ğŸ”„ é‡æ„ `commitPanel.ts`
- ğŸ”„ é‡æ„ `updatePanel.ts`

### ç¬¬ä¸‰é˜¶æ®µï¼šç»„ä»¶åŒ–ä¼˜åŒ–
- ğŸ“‹ åˆ›å»ºå¯å¤ç”¨çš„ WebView ç»„ä»¶
- ğŸ“‹ ç»Ÿä¸€çŠ¶æ€ç®¡ç†
- ğŸ“‹ ä¼˜åŒ–æ€§èƒ½å’Œç”¨æˆ·ä½“éªŒ

## ğŸ“Š æ•ˆæœå¯¹æ¯”

| æŒ‡æ ‡ | é‡æ„å‰ | é‡æ„å | æ”¹è¿› |
|------|--------|--------|------|
| ä»£ç è¡Œæ•° | 1237 è¡Œ | ~400 è¡Œ | â¬‡ï¸ 67% |
| å¯ç»´æŠ¤æ€§ | âŒ å·® | âœ… å¥½ | â¬†ï¸ æ˜¾è‘—æå‡ |
| ä»£ç å¤ç”¨ | âŒ æ—  | âœ… é«˜ | â¬†ï¸ æ–°å¢èƒ½åŠ› |
| å¼€å‘æ•ˆç‡ | âŒ ä½ | âœ… é«˜ | â¬†ï¸ æ˜¾è‘—æå‡ |
| é”™è¯¯ç‡ | âŒ é«˜ | âœ… ä½ | â¬‡ï¸ æ˜¾è‘—é™ä½ |

## ğŸ”§ æŠ€æœ¯ç»†èŠ‚

### æ¨¡æ¿å˜é‡ç³»ç»Ÿ
```typescript
interface TemplateVariables {
    FILTER_INFO: string;
    FILE_LIST: string;
    PREFIX_OPTIONS: string;
    LATEST_PREFIX: string;
}
```

### CSP å®‰å…¨ç­–ç•¥
```typescript
const csp = TemplateManager.createCSP(true, true);
// "default-src 'none'; style-src 'unsafe-inline'; script-src 'unsafe-inline';"
```

### é”™è¯¯å¤„ç†
- æ¨¡æ¿æ–‡ä»¶ä¸å­˜åœ¨æ—¶çš„å¤‡ç”¨æ–¹æ¡ˆ
- å¼‚æ­¥åŠ è½½å¤±è´¥çš„é™çº§å¤„ç†
- è¯¦ç»†çš„é”™è¯¯æ—¥å¿—è®°å½•

## ğŸš€ æœªæ¥æ‰©å±•

1. **çƒ­é‡è½½å¼€å‘**ï¼šå¼€å‘æ—¶è‡ªåŠ¨é‡è½½æ¨¡æ¿æ–‡ä»¶
2. **æ¨¡æ¿ç¼“å­˜**ï¼šæå‡åŠ è½½æ€§èƒ½
3. **å›½é™…åŒ–æ”¯æŒ**ï¼šå¤šè¯­è¨€æ¨¡æ¿ç³»ç»Ÿ
4. **ä¸»é¢˜ç³»ç»Ÿ**ï¼šåŠ¨æ€ä¸»é¢˜åˆ‡æ¢
5. **ç»„ä»¶åº“**ï¼šå¯å¤ç”¨çš„ WebView ç»„ä»¶é›†åˆ

è¿™ä¸ªé‡æ„æ–¹æ¡ˆæ˜¾è‘—æå‡äº†ä»£ç çš„å¯ç»´æŠ¤æ€§ã€å¯è¯»æ€§å’Œå¼€å‘æ•ˆç‡ï¼Œæ˜¯ç°ä»£ VSCode æ’ä»¶å¼€å‘çš„æœ€ä½³å®è·µã€‚ 