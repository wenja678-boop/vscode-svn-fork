// åœ¨window.addEventListener('message', event => { ... })ä¸­çš„case 'updateLogList'éƒ¨åˆ†è¿›è¡Œä¿®æ”¹ï¼š

case 'updateLogList':
    // æ£€æŸ¥æ˜¯å¦æ˜¯åŠ è½½æ›´å¤šæ“ä½œ
    const isLoadingMore = message.isLoadingMore === true;
    debugLog('æ”¶åˆ°æ—¥å¿—åˆ—è¡¨æ›´æ–°ï¼ŒåŠ è½½æ›´å¤šæ¨¡å¼: ' + isLoadingMore + ', æ¡ç›®æ•°: ' + message.logEntries.length);
    
    if (isLoadingMore) {
        // è¿½åŠ æ–°åŠ è½½çš„æ—¥å¿—æ¡ç›®åˆ°ç°æœ‰æ¡ç›®å
        logEntries = [...logEntries, ...message.logEntries];
        debugLog('è¿½åŠ æ—¥å¿—æ¡ç›®ï¼Œå½“å‰æ€»æ•°: ' + logEntries.length);
    } else {
        // é¦–æ¬¡åŠ è½½æˆ–åˆ·æ–°æ“ä½œï¼Œæ›¿æ¢æ‰€æœ‰æ¡ç›®
        logEntries = message.logEntries;
        debugLog('æ›¿æ¢æ—¥å¿—æ¡ç›®ï¼Œæ–°æ¡ç›®æ•°: ' + logEntries.length);
    }
    
    // æ›´æ–°æ˜¯å¦æœ‰æ›´å¤šæ—¥å¿—çš„æ ‡è®°
    const hasMoreLogs = message.hasMoreLogs !== false;
    
    // æ›´æ–°isDirectoryçŠ¶æ€
    if (message.hasOwnProperty('isDirectory')) {
        isDirectory = message.isDirectory;
        debugLog('æ›´æ–°isDirectory: ' + isDirectory);
    }
    
    // æ›´æ–°SVNç›¸å¯¹è·¯å¾„
    if (message.targetSvnRelativePath) {
        targetSvnRelativePath = message.targetSvnRelativePath;
        debugLog('æ›´æ–°SVNç›¸å¯¹è·¯å¾„: ' + targetSvnRelativePath);
    }
    
    // å¦‚æœæœ‰é€‰ä¸­çš„ä¿®è®¢ç‰ˆæœ¬ï¼Œä½¿ç”¨å®ƒ
    if (message.selectedRevision) {
        selectedRevision = message.selectedRevision;
        debugLog('ä½¿ç”¨æœåŠ¡å™¨æä¾›çš„é€‰ä¸­ä¿®è®¢ç‰ˆæœ¬: ' + selectedRevision);
    } else if (logEntries.length > 0 && !selectedRevision && !isLoadingMore) {
        // å¦åˆ™ï¼Œå¦‚æœæœ‰æ—¥å¿—æ¡ç›®ï¼Œä¸”æ²¡æœ‰é€‰ä¸­çš„ç‰ˆæœ¬ï¼Œé»˜è®¤é€‰æ‹©ç¬¬ä¸€ä¸ª
        // æ³¨æ„ï¼šåªåœ¨é"åŠ è½½æ›´å¤š"æ¨¡å¼ä¸‹æ‰§è¡Œæ­¤æ“ä½œ
        selectedRevision = logEntries[0].revision;
        debugLog('é»˜è®¤é€‰æ‹©ç¬¬ä¸€ä¸ªä¿®è®¢ç‰ˆæœ¬: ' + selectedRevision);
        
        // è‡ªåŠ¨è§¦å‘é€‰æ‹©ç¬¬ä¸€ä¸ªæ—¥å¿—æ¡ç›®
        vscode.postMessage({
            command: 'selectRevision',
            revision: selectedRevision
        });
    }
    
    renderLogList(logEntries, hasMoreLogs);
    break;

// ä¿®æ”¹renderLogListå‡½æ•°ï¼Œæ·»åŠ hasMoreLogså‚æ•°
function renderLogList(entries, hasMoreLogs = true) {
    debugLog('æ¸²æŸ“æ—¥å¿—åˆ—è¡¨ï¼Œæ¡ç›®æ•°: ' + entries.length + ', æ˜¯å¦æœ‰æ›´å¤š: ' + hasMoreLogs);
    if (!entries || entries.length === 0) {
        logList.innerHTML = `
            <div class="empty-state">
                <div class="empty-icon">ğŸ“‹</div>
                <div>æ²¡æœ‰æ‰¾åˆ°æ—¥å¿—è®°å½•</div>
            </div>
        `;
        return;
    }
    
    let html = '';
    
    entries.forEach(entry => {
        const isSelected = entry.revision === selectedRevision;
        const messagePreview = entry.message.length > 100 
            ? entry.message.substring(0, 100) + '...' 
            : entry.message;
        
        html += `
            <div class="log-entry ${isSelected ? 'selected' : ''}" data-revision="${entry.revision}">
                <div class="log-header">
                    <span class="log-revision">ä¿®è®¢ç‰ˆæœ¬ ${entry.revision}</span>
                    <span class="log-author">${entry.author}</span>
                </div>
                <div class="log-date">${entry.date}</div>
                <div class="log-message">${messagePreview}</div>
            </div>
        `;
    });
    
    // åªæœ‰å½“è¿˜æœ‰æ›´å¤šæ—¥å¿—å¯åŠ è½½æ—¶ï¼Œæ‰æ˜¾ç¤º"åŠ è½½æ›´å¤š"æŒ‰é’®
    if (hasMoreLogs) {
        html += `
            <div class="load-more">
                <button id="loadMoreButton">åŠ è½½æ›´å¤š</button>
            </div>
        `;
    } else {
        html += `
            <div class="load-more">
                <div class="no-more-logs">å·²åŠ è½½å…¨éƒ¨æ—¥å¿—</div>
            </div>
        `;
    }
    
    logList.innerHTML = html;
    debugLog('æ—¥å¿—åˆ—è¡¨æ¸²æŸ“å®Œæˆ');
    
    // æ·»åŠ ç‚¹å‡»äº‹ä»¶
    // ... ç°æœ‰ä»£ç ä¿æŒä¸å˜ ...
} 